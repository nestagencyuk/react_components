import { Meta, Story, Canvas, Preview, Props } from '@storybook/addon-docs/blocks'
import { Fragment, useContext, useState } from 'react'
import { ToggleContext, Toggle } from '../../context/Toggle'
import { Text } from '../Text'
import { Button } from '../Button'
import { Float } from '../Float'
import { Alert } from '.'

<Meta title='Components|Alert' component={Alert} />

# Alert
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus lacinia turpis mattis justo pellentesque, ac vulputate felis dictum. Integer risus enim, posuere quis elementum non, commodo molestie odio.

## Base
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus lacinia turpis mattis justo pellentesque, ac vulputate felis dictum. Integer risus enim, posuere quis elementum non, commodo molestie odio.

<Preview>
  <Story name='Base'>
    <Alert inline>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
    </Alert>
  </Story>
</Preview>

## Toggle
To create an alert popover, the base alert component can be combined with [Toggle](/?path=/docs/interaction-toggle--base) and [Float](/?path=/docs/layout-float--base).

<Preview>
  <Story name='Toggle'>
    <Toggle>
      {({ toggled, setToggled }) => (
        <Fragment>
          <Button type='Primary' onClick={() => setToggled(true)}>Open Alert</Button>
          {toggled && <Float portal>
            <Alert onClose={setToggled}>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus lacinia turpis mattis justo pellentesque, ac vulputate felis dictum. Integer risus enim, posuere quis elementum non, commodo molestie odio.
            </Alert>
          </Float>}
        </Fragment>
      )}
    </Toggle>
  </Story>
</Preview>

## Types
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus lacinia turpis mattis justo pellentesque, ac vulputate felis dictum. Integer risus enim, posuere quis elementum non, commodo molestie odio.

<Preview>
  <Story name='Alert-Error'>
    <Alert inline type='Error'>
      There was an error!
    </Alert>
  </Story>
</Preview>

<Preview>
  <Story name='Alert-Warning'>
    <Alert inline type='Warning'>
      I'm warning you...
    </Alert>
  </Story>
</Preview>

<Preview>
  <Story name='Alert-Success'>
    <Alert inline type='Success'>
      Wow, it worked!
    </Alert>
  </Story>
</Preview>

## Timeout
Set a timeout so that the alert disappeares after some time.

<Preview>
  <Story name='Alert-Timeout'>
    <Toggle timeout={2000}>
      {({ toggled, setToggled }) => (
        <Fragment>
          <Button type='Primary' onClick={() => setToggled(true)}>Open Success Alert</Button>
          {toggled && <Float portal>
            <Alert type='Success'>
              Wow, it worked!
            </Alert>
          </Float>}
        </Fragment>
      )}
    </Toggle>
  </Story>
</Preview>

## Confirm
An alert can be used to determine an action.

<Preview>
  <Story name='Confirm'>
    <Toggle>
      {({ toggled, setToggled }) => {
        const [decision, setDecision] = useState(null)
        return (
          <Fragment>
            <Button type='Primary' onClick={() => setToggled(true)}>Do something mad!</Button>
            {decision !== null && <Text>{decision ? 'Living on the wild side!' : 'Oh, :( boring'}</Text>}
            {toggled && <Float portal>
              <Alert type='Warning' footer={{
                actions: [
                  { text: 'No', type: 'Tertiary', size: 'Small', onClick: () => { setDecision(false); setToggled(false) } },
                  { text: 'Yes', type: 'Primary', size: 'Small', onClick: () => { setDecision(true); setToggled(false) } },
                ]
              }}>
                Are you sure you want to do this crazy thing?!
              </Alert>
            </Float>}
          </Fragment>
        )
      }}
    </Toggle>
  </Story>
</Preview>

## Prop Types

<Props of={Alert} />

## To Do
- A11y improvements - trap focus within an alert when it appears if a user action is required
- Write Cypress tests