import { Meta, Story, Canvas, Preview, Props } from '@storybook/addon-docs/blocks'
import { Fragment, useContext, useState } from 'react'
import { Text } from '../../components/Text'
import { Button } from '../../components/Button'
import { Field } from '../../components/Field'
import { Input } from '../../components/Input'
import { Select } from '../../components/Select'
import { FormV2, useField } from '@nestagencyuk/react_form-factory'
import { useManageArray } from '.'

<Meta title="Hooks|Manage Array" component={null} />

# Manage Array
A hook for adding, editing and removing items from an array, e.g rows in a table.

## Base
The hook in its simplest form. For a string array where all values must be unique.

<Preview>
  <Story name="Base">
    {() => {
      const [editing, setEditing] = useState(false)
      const { array, addItem, editItem, deleteItem } = useManageArray()
      return (
        <Fragment>
          <Text>Value:</Text>
          <pre className="p--md bg--ui-one text--sm">{JSON.stringify(array, null, 2)}</pre>
          {array && array.map((x, i) => (
            <Form key={`form-${i}`} savedData={{ name: x }} onSubmit={(formData) => { editItem(formData.name, i); setEditing(false) }}>
              {({ handleSubmit }) => (
                <form style={{ display: 'flex' }} onSubmit={(e) => e.preventDefault()}>
                  <FieldState id="name">{(field) => <Field id={`name-${i}`} label="Name" disabled={!editing} {...field} />}</FieldState>
                  {editing ? (
                    <Button variant="Tertiary" size="Small" type="submit" onClick={handleSubmit}>Save</Button>
                  ) : (
                    <Button variant="Tertiary" size="Small" onClick={() => setEditing(true)}>Edit</Button>
                  )}
                  <Button className="m m--l-md" variant="Tertiary" size="Small" onClick={() => deleteItem(x)}>Delete</Button>
                </form>
              )}
            </Form>
          ))}
          <Form onSubmit={(formData) => addItem(formData.name)}>
            {({ valid, handleSubmit }) => (
              <form style={{ display: 'flex' }} onSubmit={handleSubmit}>
                <FieldState id="name" required>{(field) => <Field id="name" label="Name" {...field} />}</FieldState>
                <Button type="submit" disabled={!valid}>Add</Button>
              </form>
            )}
          </Form>
        </Fragment>
      )
    }}
  </Story>
</Preview>

## Object
The hook also accepts an array of objects. It will add a `_uid` property to each object with a generated unique id. You can filter this out in your final payload.

<Preview>
  <Story name="Object">
    {() => {
      const [editing, setEditing] = useState(false)
      const { array, addItem, editItem, deleteItem } = useManageArray()
      const FormField = ({ id, label, type, required, options }) => {
        const { value, handleChange } = useField({ id, required })
        return (
          <Field id={id} label={label} type={type} options={options} value={value} onChange={handleChange} />
        )
      }
      return (
        <Fragment>
          <Text>Value:</Text>
          <pre className="p--md bg--ui-one text--sm">{JSON.stringify(array, null, 2)}</pre>
          {array && array.map((x, i) => (
            <FormV2 key={`form-${x._uid}`} data={x} onSubmit={(newData) => { editItem(newData); setEditing(false) }}>
              {({ handleSubmit }) => (
                <form style={{ display: 'flex' }} onSubmit={(e) => e.preventDefault()}>
                  <FormField id="name" label="Name" />
                  <FormField id="age" label="Age" type="Number" />
                  <FormField id="gender" label="Gender"type="Select" options={[{ value:'male', label: 'Male'}, { value:'female', label: 'Female'}]} />
                  {editing ? (
                    <Button variant="Tertiary" size="Small" type="submit" onClick={handleSubmit}>Save</Button>
                  ) : (
                    <Button variant="Tertiary" size="Small" onClick={() => setEditing(true)}>Edit</Button>
                  )}
                  <Button className="m m--l-md" variant="Tertiary" size="Small" onClick={() => deleteItem(x._uid)}>Delete</Button>
                </form>
              )}
            </FormV2>
          ))}
          <FormV2 data={{ name: null, age: null, gender: null }} onSubmit={(data) => addItem(data)}>
            {({ handleSubmit }) => (
              <form style={{ display: 'flex' }} onSubmit={handleSubmit}>
                <FormField id="name" label="Name" />
                <FormField id="age" label="Age" type="Number" />
                <FormField 
                  id="gender"
                  label="Gender"
                  type="Select" 
                  options={[{ value:'male', label: 'Male'}, { value:'female', label: 'Female'}]}
                />
                <Button type="submit">Add</Button>
              </form>
            )}
          </FormV2>
        </Fragment>
      )
    }}
  </Story>
</Preview>
